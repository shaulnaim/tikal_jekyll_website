---
layout: post
title: Maintain sort on a DataGrid when the dataProvider is changed
created: 1338394544
author: avit
permalink: /maintain-sort-datagrid-when-dataprovider-changed
tags:
- RoR
- web
- ruby
---
<p>Usually, in our <a href='http://www.kensodev.com/category/flex/' title='Flex'>Flex</a> application we do have a data-grid. This component is very useful for displaying data and have a sorting, ordering of columns and more, out of the box.</p>

<p>I can speak for my applications and say that every enterprise application I have ever build had at least one or more data-Grid’s inside it.</p>

<p>So, what can we say about a grid that has not been said before in the past…?</p>

<p>I recently had a grid that I enabled sorting on it. It had a data-Provider (ArrayCollection) and I needed to preserver the sorting when the collection had changed.</p>

<p>The default behavior when you hookup a collection to the dataProvider property of the grid, is that when the collection changes, it will change the sorting back to default.</p>

<p>This is the code before the fix:</p>
<div class='highlight'><pre><code class='actionscript'>			<span class='o'>&</span><span class='nx'>lt</span><span class='o'>;</span><span class='nx'>mx</span><span class='o'>:</span><span class='nx'>DataGrid</span>  <span class='nx'>width</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='mi'>100</span><span class='o'>%&</span><span class='nx'>quot</span><span class='o'>;</span>
							<span class='nx'>height</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='mi'>100</span><span class='o'>%&</span><span class='nx'>quot</span><span class='o'>;</span>
							<span class='nx'>id</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>dataGrid</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span>
							<span class='nx'>dataProvider</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='p'>{</span><span class='nx'>myHelper</span><span class='p'>.</span><span class='nx'>widgetModel</span><span class='p'>.</span><span class='nx'>data</span><span class='p'>}</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span>
							<span class='nx'>itemClick</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>myHelper</span><span class='p'>.</span><span class='nx'>updateCustomFieldsButtonBar</span><span class='p'>()</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span>
							<span class='nx'>allowMultipleSelection</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='kc'>true</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span>
							<span class='nx'>updateComplete</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>myHelper</span><span class='p'>.</span><span class='nx'>gridUpdateComplete</span><span class='p'>(</span><span class='nx'>event</span><span class='p'>)</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;&</span><span class='nx'>gt</span><span class='o'>;</span>
				<span class='o'>&</span><span class='nx'>lt</span><span class='o'>;</span><span class='nx'>mx</span><span class='o'>:</span><span class='nx'>columns</span><span class='o'>&</span><span class='nx'>gt</span><span class='o'>;</span>
					<span class='o'>&</span><span class='nx'>lt</span><span class='o'>;</span><span class='nx'>mx</span><span class='o'>:</span><span class='nx'>DataGridColumn</span> <span class='nx'>dataField</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>id</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='nx'>headerText</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>id</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='nx'>visible</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='kc'>false</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;/&</span><span class='nx'>gt</span><span class='o'>;</span>
					<span class='o'>&</span><span class='nx'>lt</span><span class='o'>;</span><span class='nx'>mx</span><span class='o'>:</span><span class='nx'>DataGridColumn</span> <span class='nx'>dataField</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>name</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='nx'>headerText</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>Field</span> <span class='nx'>Name</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='o'>/&</span><span class='nx'>gt</span><span class='o'>;</span>
					<span class='o'>&</span><span class='nx'>lt</span><span class='o'>;</span><span class='nx'>mx</span><span class='o'>:</span><span class='nx'>DataGridColumn</span> <span class='nx'>dataField</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>description</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='nx'>headerText</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>Description</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='o'>/&</span><span class='nx'>gt</span><span class='o'>;</span>
					<span class='o'>&</span><span class='nx'>lt</span><span class='o'>;</span><span class='nx'>mx</span><span class='o'>:</span><span class='nx'>DataGridColumn</span> <span class='nx'>dataField</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>typeDisplayName</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='nx'>headerText</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>Type</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='o'>/&</span><span class='nx'>gt</span><span class='o'>;</span>
					<span class='o'>&</span><span class='nx'>lt</span><span class='o'>;</span><span class='nx'>mx</span><span class='o'>:</span><span class='nx'>DataGridColumn</span> <span class='nx'>dataField</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>entityTypes</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='nx'>headerText</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>Entity</span> <span class='nx'>Type</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='o'>/&</span><span class='nx'>gt</span><span class='o'>;</span>
					<span class='o'>&</span><span class='nx'>lt</span><span class='o'>;</span><span class='nx'>mx</span><span class='o'>:</span><span class='nx'>DataGridColumn</span> <span class='nx'>dataField</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>listId</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='nx'>headerText</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>Entity</span> <span class='nx'>Type</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='nx'>visible</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='kc'>false</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;/&</span><span class='nx'>gt</span><span class='o'>;</span>
				<span class='o'>&</span><span class='nx'>lt</span><span class='o'>;/</span><span class='nx'>mx</span><span class='o'>:</span><span class='nx'>columns</span><span class='o'>&</span><span class='nx'>gt</span><span class='o'>;</span>

			<span class='o'>&</span><span class='nx'>lt</span><span class='o'>;/</span><span class='nx'>mx</span><span class='o'>:</span><span class='nx'>DataGrid</span><span class='o'>&</span><span class='nx'>gt</span><span class='o'>;</span>
</code></pre>
</div>
<p>This peace of code it the most important peace in the puzzle, wiring up (binding) between a model (collection) and the dataProvider:</p>
<div class='highlight'><pre><code class='actionscript'><span class='nx'>dataProvider</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='p'>{</span><span class='nx'>myHelper</span><span class='p'>.</span><span class='nx'>widgetModel</span><span class='p'>.</span><span class='nx'>data</span><span class='p'>}</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span>
</code></pre>
</div>
<p>So, we know that this way does not work. What do we need to do in order to save the sorting when the provider changes? What we actually need to do is to create a view of our collection, provide it with data and wire it up to the grid</p>

<p>This is how we do it.</p>
<div class='highlight'><pre><code class='actionscript'><span class='o'>&</span><span class='nx'>lt</span><span class='o'>;</span><span class='nx'>mx</span><span class='o'>:</span><span class='nx'>ListCollectionView</span> <span class='nx'>list</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='p'>{</span><span class='nx'>helper</span><span class='p'>.</span><span class='nx'>widgetModel</span><span class='p'>.</span><span class='nx'>data</span><span class='p'>}</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='nx'>id</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>listCollectionView</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='o'>/&</span><span class='nx'>gt</span><span class='o'>;</span>

			<span class='o'>&</span><span class='nx'>lt</span><span class='o'>;</span><span class='nx'>mx</span><span class='o'>:</span><span class='nx'>DataGrid</span>  <span class='nx'>width</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='mi'>100</span><span class='o'>%&</span><span class='nx'>quot</span><span class='o'>;</span>
							<span class='nx'>height</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='mi'>100</span><span class='o'>%&</span><span class='nx'>quot</span><span class='o'>;</span>
							<span class='nx'>id</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>dataGrid</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span>
							<span class='nx'>dataProvider</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='p'>{</span><span class='nx'>listCollectionView</span><span class='p'>}</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span>
							<span class='nx'>itemClick</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>myHelper</span><span class='p'>.</span><span class='nx'>updateCustomFieldsButtonBar</span><span class='p'>()</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span>
							<span class='nx'>allowMultipleSelection</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='kc'>true</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span>
							<span class='nx'>updateComplete</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>myHelper</span><span class='p'>.</span><span class='nx'>gridUpdateComplete</span><span class='p'>(</span><span class='nx'>event</span><span class='p'>)</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;&</span><span class='nx'>gt</span><span class='o'>;</span>
				<span class='o'>&</span><span class='nx'>lt</span><span class='o'>;</span><span class='nx'>mx</span><span class='o'>:</span><span class='nx'>columns</span><span class='o'>&</span><span class='nx'>gt</span><span class='o'>;</span>
					<span class='o'>&</span><span class='nx'>lt</span><span class='o'>;</span><span class='nx'>mx</span><span class='o'>:</span><span class='nx'>DataGridColumn</span> <span class='nx'>dataField</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>id</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='nx'>headerText</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>id</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='nx'>visible</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='kc'>false</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;/&</span><span class='nx'>gt</span><span class='o'>;</span>
					<span class='o'>&</span><span class='nx'>lt</span><span class='o'>;</span><span class='nx'>mx</span><span class='o'>:</span><span class='nx'>DataGridColumn</span> <span class='nx'>dataField</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>name</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='nx'>headerText</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>Field</span> <span class='nx'>Name</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='o'>/&</span><span class='nx'>gt</span><span class='o'>;</span>
					<span class='o'>&</span><span class='nx'>lt</span><span class='o'>;</span><span class='nx'>mx</span><span class='o'>:</span><span class='nx'>DataGridColumn</span> <span class='nx'>dataField</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>description</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='nx'>headerText</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>Description</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='o'>/&</span><span class='nx'>gt</span><span class='o'>;</span>
					<span class='o'>&</span><span class='nx'>lt</span><span class='o'>;</span><span class='nx'>mx</span><span class='o'>:</span><span class='nx'>DataGridColumn</span> <span class='nx'>dataField</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>typeDisplayName</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='nx'>headerText</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>Type</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='o'>/&</span><span class='nx'>gt</span><span class='o'>;</span>
					<span class='o'>&</span><span class='nx'>lt</span><span class='o'>;</span><span class='nx'>mx</span><span class='o'>:</span><span class='nx'>DataGridColumn</span> <span class='nx'>dataField</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>entityTypes</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='nx'>headerText</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>Entity</span> <span class='nx'>Type</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='o'>/&</span><span class='nx'>gt</span><span class='o'>;</span>
					<span class='o'>&</span><span class='nx'>lt</span><span class='o'>;</span><span class='nx'>mx</span><span class='o'>:</span><span class='nx'>DataGridColumn</span> <span class='nx'>dataField</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>listId</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='nx'>headerText</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='nx'>Entity</span> <span class='nx'>Type</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;</span> <span class='nx'>visible</span><span class='o'>=&</span><span class='nx'>quot</span><span class='o'>;</span><span class='kc'>false</span><span class='o'>&</span><span class='nx'>quot</span><span class='o'>;/&</span><span class='nx'>gt</span><span class='o'>;</span>
				<span class='o'>&</span><span class='nx'>lt</span><span class='o'>;/</span><span class='nx'>mx</span><span class='o'>:</span><span class='nx'>columns</span><span class='o'>&</span><span class='nx'>gt</span><span class='o'>;</span>

			<span class='o'>&</span><span class='nx'>lt</span><span class='o'>;/</span><span class='nx'>mx</span><span class='o'>:</span><span class='nx'>DataGrid</span><span class='o'>&</span><span class='nx'>gt</span><span class='o'>;</span>
</code></pre>
</div>
<p>Notice that the grid’s data provider is not the collection view.</p>

<p>Now, when the data will change, the sorting will not change.</p>

<p>Good luck!</p>
      
    <img src="http://feeds.feedburner.com/~r/KensoDev-en/~4/Q6Sg_1xlqDM" height="1" width="1"/>
