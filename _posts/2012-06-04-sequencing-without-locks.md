---
layout: post
title: Sequencing without Locks
created: 1338802026
author: ittayd
permalink: /sequencing-without-locks
tags:
- JAVA
- concurrency
---
<p class="MsoNormal">The usual way to sequence operations on a resource is by using locks. Get a lock before accessing the resource and release it after. In this post I&rsquo;ll write about a mechanism that avoids (explicit) locking. We&rsquo;ve used this mechanism at a previous company I&rsquo;ve worked with to gain performance and stability.</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">What is wrong with locking? Well, two main things:</p>
<p style="margin-left:19.5pt;mso-add-space:
auto;text-indent:-18.0pt;mso-list:l1 level1 lfo1" class="MsoListParagraphCxSpFirst"><span style="mso-bidi-font-family:Calibri;mso-bidi-theme-font:minor-latin"><span style="mso-list:Ignore">1.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span>The thread that attempts to acquire the lock is blocked until the lock is acquired. This means it cannot do any work and is therefore taking memory resources (stack size) without contributing anything.</p>
<p style="margin-left: 19.5pt; text-indent: -18pt;" class="MsoListParagraphCxSpFirst">&nbsp;</p>
<p style="margin-left:19.5pt;mso-add-space:auto;
text-indent:-18.0pt;mso-list:l1 level1 lfo1" class="MsoListParagraphCxSpLast"><span style="mso-bidi-font-family:Calibri;mso-bidi-theme-font:minor-latin"><span style="mso-list:Ignore">2.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span>Locks may lead to deadlocks. If two locks are acquired by different threads in reverse order, then this is a deadlock waiting to happen.</p>
<p style="margin-left: 19.5pt; text-indent: -18pt;" class="MsoListParagraphCxSpLast">&nbsp;</p>
<p class="MsoNormal">There are some alternative ways to locking:</p>
<p style="margin-left:19.5pt;mso-add-space:
auto;text-indent:-18.0pt;mso-list:l3 level1 lfo2" class="MsoListParagraphCxSpFirst"><span style="mso-bidi-font-family:Calibri;mso-bidi-theme-font:minor-latin"><span style="mso-list:Ignore">1.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span>Using `tryLock`. In which if the lock cannot be acquired the method returns at once with a false result. Then it is up to the caller to decide what to do. Usually, a reattempt is made. Which means of course that the thread is just redoing what it already did, so it wastes memory as well as CPU. Also, there&rsquo;s no guarantee that the next attempt will acquire the lock. This method (as well as acquiring with timeout) is mainly good for avoiding deadlocks at the price of more complex calling code.</p>
<p style="margin-left: 19.5pt; text-indent: -18pt;" class="MsoListParagraphCxSpFirst">&nbsp;</p>
<p style="margin-left:19.5pt;mso-add-space:
auto;text-indent:-18.0pt;mso-list:l3 level1 lfo2" class="MsoListParagraphCxSpMiddle"><span style="mso-bidi-font-family:Calibri;mso-bidi-theme-font:minor-latin"><span style="mso-list:Ignore">2.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span>Using optimistic locking. This method is good mainly when working with databases. The thread reads a resource (a record in the database) which contains a timestamp indicating the last time the resource was changed. When the thread updates the resource, if the timestamp hasn&rsquo;t changed, it is allowed to carry on the update. Otherwise, it fails. As with the tryLock method, this mainly avoids deadlocks, but wastes time retrying the same logic. It is also not suitable when transactions are not possible. E.g., if modifying external resources that do not support rollback (e.g, rebooting a machine)</p>
<p style="margin-left: 19.5pt; text-indent: -18pt;" class="MsoListParagraphCxSpMiddle">&nbsp;</p>
<p><span style="mso-bidi-font-family:Calibri;mso-bidi-theme-font:minor-latin"><span style="mso-list:Ignore">3.<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span>Using different concurrency models: The <a href="http://en.wikipedia.org/wiki/Actor_model">Actor</a> model and <a href="http://en.wikipedia.org/wiki/Dataflow">Dataflow</a>. These are great models but one changes the whole paradigm of development while the other is mainly suitable for &ldquo;spreadsheet&rdquo; like scenarios.</p>
<p>&nbsp;</p>
<p style="margin-left: 19.5pt; text-indent: -18pt;" class="MsoListParagraphCxSpLast">&nbsp;</p>
<p class="MsoNormal">At my previous company we were in a situation where we were using the standard way of accessing shared resources. The problems we were facing is that we had no control over our threads. We needed to create many threads to accommodate requests made to the system because many of them were blocked on locks and could not service those requests. We also had to fight many deadlocks, and we also had a lot of cases where operations didn&rsquo;t finish on time because threads were blocked which caused timing issues.</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">The alternative we used was based on <a href="http://en.wikipedia.org/wiki/Staged_event-driven_architecture">SEDA</a>. In the SEDA paradigm, complex workflows are broken into stages. Each stage is a queue of tasks serviced by a (global) thread pool. When each task is processed, it can create further tasks for downstream stages. This model allows to decouple logic from threading (a workflow is processed by several threads until completion) and also helps prioritize different stages by assigning more or less threads to process the queue of that stage.</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">How did this help us achieve a better sequencing scheme? Well for every resource we had a designated queue (obviously, you can&rsquo;t do that when you have millions of resources, but we were dealing with thousands). If we needed to modify a resource, we created a task and put it in the queue. The framework guaranteed that only one thread would process tasks of that queue at any given time and hence there couldn&rsquo;t be two threads accessing the same queue (in this respect, this is a lot like the Actor model)</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">The interesting part was dealing with tasks that needed to change several resources. You can&rsquo;t always break such class into discrete subtasks that only modify a single resource, and so we needed a better mechanism. The mechanism we used was this:</p>
<p style="margin-left:37.5pt;mso-add-space:
auto;text-indent:-18.0pt;mso-list:l2 level1 lfo3" class="MsoListParagraphCxSpFirst"><span style="font-family:&quot;Courier New&quot;;mso-fareast-font-family:&quot;Courier New&quot;"><span style="mso-list:Ignore">o<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;</span></span></span><span style="font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:
Symbol"><span style="mso-list:Ignore"><span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span>Each task would be labeled with the resources it was about to modify. E.g. &ldquo;res1&rdquo;, &ldquo;res2&rdquo;. If a piece of logic first needed to find (query) what resources to modify, then it would be split into two tasks (finding &amp; modifying).</p>
<p style="margin-left:37.5pt;mso-add-space:
auto;text-indent:-18.0pt;mso-list:l2 level1 lfo3" class="MsoListParagraphCxSpMiddle"><span style="font-family:&quot;Courier New&quot;;mso-fareast-font-family:&quot;Courier New&quot;"><span style="mso-list:Ignore">o<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;</span></span></span><span style="font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:
Symbol"><span style="mso-list:Ignore"><span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span>The task would be put into all queues representing the resources it meant to modify. In the example above it meant it was put into queues q1 and q2.</p>
<p style="margin-left:37.5pt;mso-add-space:
auto;text-indent:-18.0pt;mso-list:l2 level1 lfo3" class="MsoListParagraphCxSpMiddle"><span style="font-family:&quot;Courier New&quot;;mso-fareast-font-family:&quot;Courier New&quot;"><span style="mso-list:Ignore">o<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;</span></span></span><span style="font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:
Symbol"><span style="mso-list:Ignore"><span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span>The thread pool would scan all queues according to order (e.g., lexicographic ordering by name or id)</p>
<p style="margin-left:37.5pt;mso-add-space:
auto;text-indent:-18.0pt;mso-list:l2 level1 lfo3" class="MsoListParagraphCxSpMiddle"><span style="font-family:&quot;Courier New&quot;;mso-fareast-font-family:&quot;Courier New&quot;"><span style="mso-list:Ignore">o<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;</span></span></span><span style="font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:
Symbol"><span style="mso-list:Ignore"><span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span>A thread would dequeue a task from a queue and increase a counter in the queue saying it had +1 running tasks. This means no more tasks will be dequeued from it until the counter is decreased.</p>
<p style="margin-left:37.5pt;mso-add-space:
auto;text-indent:-18.0pt;mso-list:l2 level1 lfo3" class="MsoListParagraphCxSpMiddle"><span style="font-family:&quot;Courier New&quot;;mso-fareast-font-family:&quot;Courier New&quot;"><span style="mso-list:Ignore">o<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;</span></span></span><span style="font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:
Symbol"><span style="mso-list:Ignore"><span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span>The thread would also remove the label of the matching resource from the task (we actually kept a counter and compared to the number of labels)</p>
<p style="margin-left:37.5pt;mso-add-space:
auto;text-indent:-18.0pt;mso-list:l2 level1 lfo3" class="MsoListParagraphCxSpMiddle"><span style="font-family:&quot;Courier New&quot;;mso-fareast-font-family:&quot;Courier New&quot;"><span style="mso-list:Ignore">o<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;</span></span></span><span style="font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:
Symbol"><span style="mso-list:Ignore"><span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span>If the tasks has no more labels, it means it is able to run (it was dequeued from all queues and those queues have no other tasks being processed). The task would then run, modifying resources.</p>
<p style="margin-left:37.5pt;mso-add-space:
auto;text-indent:-18.0pt;mso-list:l2 level1 lfo3" class="MsoListParagraphCxSpMiddle"><span style="font-family:&quot;Courier New&quot;;mso-fareast-font-family:&quot;Courier New&quot;"><span style="mso-list:Ignore">o<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;</span></span></span><span style="font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:
Symbol"><span style="mso-list:Ignore"><span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span>If the tasks had more labels, the thread would just forget about it and move on to the next queue. More labels meant it was in other queues.</p>
<p style="margin-left:37.5pt;mso-add-space:auto;
text-indent:-18.0pt;mso-list:l2 level1 lfo3" class="MsoListParagraphCxSpLast"><span style="font-family:&quot;Courier New&quot;;mso-fareast-font-family:&quot;Courier New&quot;"><span style="mso-list:Ignore">o<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;</span></span></span><span style="font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:
Symbol"><span style="mso-list:Ignore"><span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span>At the end of the tasks, the counter would be decremented from all queues it was in.</p>
<p style="margin-left: 37.5pt; text-indent: -18pt;" class="MsoListParagraphCxSpLast">&nbsp;</p>
<p class="MsoNormal">This means that when a task ran, it required no locks because the system guaranteed no other task would work on the same resources. It also meant that no threads were blocked. This allowed us to create only several threads <span style="mso-spacerun:yes">&nbsp;</span>(roughly the number of cpus) that would process thousands of tasks with high throughput.</p>
<p class="MsoNormal"><span style="mso-ignore:vglayout">  </span></p>
<p>&nbsp;</p>
<p>Here&rsquo;s an example. Say we have 3 queues: Q1, Q2, Q3. And three tasks T1,T2,T3. Each queue has a counter C. And the scenario is this:</p>
<p><img src="data:image/png;base64,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" alt="" /></p>
<p style="text-indent:-18.0pt;mso-list:l0 level1 lfo4" class="MsoListParagraphCxSpFirst"><span style="font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:
Symbol"><span style="mso-list:Ignore">&middot;<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span>First pass:</p>
<p style="margin-left:72.0pt;mso-add-space:
auto;text-indent:-18.0pt;mso-list:l0 level2 lfo4" class="MsoListParagraphCxSpMiddle"><span style="font-family:&quot;Courier New&quot;;mso-fareast-font-family:&quot;Courier New&quot;"><span style="mso-list:Ignore">o<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp; </span></span></span>T1 is dequeued from Q1. Q1 has C=1. T1 is still labeled with Q3, so it doesn&rsquo;t run. So the thread moves to the next queue</p>
<p style="margin-left:72.0pt;mso-add-space:
auto;text-indent:-18.0pt;mso-list:l0 level2 lfo4" class="MsoListParagraphCxSpMiddle"><span style="font-family:&quot;Courier New&quot;;mso-fareast-font-family:&quot;Courier New&quot;"><span style="mso-list:Ignore">o<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp; </span></span></span>T2 Is dequeued from Q2. Q2 has C=1. T2 is still labeled with Q3, so it doesn&rsquo;t run</p>
<p style="margin-left:72.0pt;mso-add-space:
auto;text-indent:-18.0pt;mso-list:l0 level2 lfo4" class="MsoListParagraphCxSpMiddle"><span style="font-family:&quot;Courier New&quot;;mso-fareast-font-family:&quot;Courier New&quot;"><span style="mso-list:Ignore">o<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp; </span></span></span>T3 is dequeued from Q3. Q3 has C=1. T3 can run so the thread executes it.</p>
<p><img src="data:image/png;base64,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" alt="" /></p>
<p>All queues now have count of 1, so nothing else runs (of course in a real system, we expect tasks to be more separate)</p>
<p style="text-indent:-18.0pt;mso-list:l0 level1 lfo4" class="MsoListParagraphCxSpMiddle"><span style="font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:
Symbol"><span style="mso-list:Ignore">&middot;<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span>Second pass:</p>
<p style="margin-left:72.0pt;mso-add-space:
auto;text-indent:-18.0pt;mso-list:l0 level2 lfo4" class="MsoListParagraphCxSpMiddle"><span style="font-family:&quot;Courier New&quot;;mso-fareast-font-family:&quot;Courier New&quot;"><span style="mso-list:Ignore">o<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp; </span></span></span>T3 finishes executing, so Q3 has C=0.</p>
<p style="margin-left:72.0pt;mso-add-space:auto;
text-indent:-18.0pt;mso-list:l0 level2 lfo4" class="MsoListParagraphCxSpLast"><span style="font-family:&quot;Courier New&quot;;mso-fareast-font-family:&quot;Courier New&quot;"><span style="mso-list:Ignore">o<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp; </span></span></span>T1 is dequeued from Q3, C=1 and the task is executed (we used to dequeue from the queues whose tasks have finished instead of full scan)</p>
<p><img src="data:image/png;base64,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" alt="" /></p>
<p><span style="font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:
Symbol"><span style="mso-list:Ignore"><span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;</span></span></span>Third pass:</p>
<p style="margin-left:72.0pt;mso-add-space:
auto;text-indent:-18.0pt;mso-list:l0 level2 lfo4" class="MsoListParagraphCxSpMiddle"><span style="font-family:&quot;Courier New&quot;;mso-fareast-font-family:&quot;Courier New&quot;"><span style="mso-list:Ignore">o<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp; </span></span></span>T1 finished, so Q3 has C=0.</p>
<p style="margin-left:72.0pt;mso-add-space:
auto;text-indent:-18.0pt;mso-list:l0 level2 lfo4" class="MsoListParagraphCxSpMiddle"><span style="font-family:&quot;Courier New&quot;;mso-fareast-font-family:&quot;Courier New&quot;"><span style="mso-list:Ignore">o<span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp; </span></span></span>T2 is dequeued from Q1 and executed</p>
<p style="margin-left:72.0pt;mso-add-space:auto" class="MsoListParagraphCxSpLast">&nbsp;</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">Note that deadlocks were not possible. For a deadlock to happen, two tasks, A and B needed to be in reverse order in two queues Q and P, so in Q the order would be A,B and in P it would be B,A. But since tasks were pushed simultaneously to all queues (there was<span style="mso-spacerun:yes">&nbsp; </span>a lock there&hellip;), this could never have happened.</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">Another characteristic was that we could define some concurrency levels on some queues. E.g., a resource could be network bandwidth. In which case, it did not require that only one task would use the network. In this case, tasks could be dequeued from the queue as long as the counter in the queue was lower than some threshold.</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">Of course locking is not the only thing that can block a thread. IO is another. This was dealt with by doing the IO action (ending the task) and waiting for it to call back the system, which generated a fresh task. <span style="mso-spacerun:yes">&nbsp;</span><span style="mso-spacerun:yes">&nbsp;</span>For DB accessed, we actually allowed the threads to be blocked. The reason was that while the thread was blocked, the CPU was used to process the query on the side of the DB (which was on the same machine), so CPU resources were not wasted and we found the system was always fully utilized. It is obvious one could have used the callback mechanism for DB access as well.</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">One final note is about read write locks. In our case, a task would be treated the same for reading or writing to a resource. But it is not hard to adapt the mechanism to allow dequeing tasks while they are just marked as reading a resource while keeping the counter to prevent dequeuing when a task is running that modifies the resource and not dequeing it if <span style="mso-spacerun:yes">&nbsp;</span>`read` tasks are running.</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">That&rsquo;s it for this post. I hope it was clear enough.</p>
<p>&nbsp;</p>
